<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>
<div id="main">
  <div class="navbar">
    <a class="active" href="#home">Inicio</a>
    <a href="#news">Noticias</a>
    <a style="float: right;">Iniciar sesion</a>
    <div class="dropdown">
      <button class="dropbtn">Ver Programas 
        <i class="fa fa-caret-down"></i>
      </button>
      <div class="dropdown-content">
        <div class="header">
          <h2>Programas Postgrado Facultad de Ingenieria</h2>
        </div>   
        <div class="row">
          <div class="column">
            <h3>Programas disponibles actuamente</h3>
            <a href="#" @click="updateProgamSelected(item)"
            v-for="(item, index) in programs">{{item.Program_name}}</a>
          </div>
        </div>
      </div>
    </div> 
  </div>

  <div class="totalcolumn" v-if="someProgramSelected==false && createNewPost==false" style="padding:16px">
    <div class="slideshow-container">

  <!-- Full-width images with number and caption text -->
  <div class="mySlides fade">
      <div class="numbertext">1 / 3</div>
      <img src="img1.png" style="width:100%">
      <div class="text">Caption Text</div>
    </div>

    <div class="mySlides fade">
      <div class="numbertext">2 / 3</div>
      <img src="img2.png" style="width:100%">
      <div class="text">Caption Two</div>
    </div>

    <div class="mySlides fade">
      <div class="numbertext">3 / 3</div>
      <img src="img1.png" style="width:100%">
      <div class="text">Caption Three</div>
    </div>

    <!-- Next and previous buttons -->
    <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
    <a class="next" onclick="plusSlides(1)">&#10095;</a>
  </div>
  <br>

  <!-- The dots/circles -->
  <div style="text-align:center">
    <span class="dot" onclick="currentSlide(1)"></span> 
    <span class="dot" onclick="currentSlide(2)"></span> 
    <span class="dot" onclick="currentSlide(3)"></span> 
  </div>
    <h3>Bienvenidos a la pagina de Pregrados de Ingenieria</h3>
    <p>Este sitio aún se encuentra en producción. Contacto: <br>ruben4181@gmail.com<br>verabrayan@gmail.com<br>nalvarez@gmail.com<br>
    <br>
    <pre>
    {{ programs }}
    </pre>
    </p>
  </div>
  <div v-else-if="someProgramSelected==true && seeMorePost==false" style="padding:16px">
  <div class="header">
    <h3>{{selectedProgram.Program_name}}</h3>
    </div>
    <div class="leftcolumn">
      <div class="card">
        <h2>Regresa al inicio</h2>
        <button class="btn default"
            @click="someProgramSelected=false">
              Atras
        </button>
      </div>
      <div id="feeds">
        <a href="#" @click="seeMore(item)"
                v-for="(item, index) in posts">
                  <div class="card">
                    <h2>{{item.Post_title}}</h2>
                    <h5>Oct 24, 2018</h5>
                    <div class="fakeimg" style="height:150px;">Image</div>
                    <p>{{item.Post_abstract}}</p>
                  </div>
        </a>
      </div>
    </div>
    <div class="rightcolumn">
      <div class="card">
        <h2>Logros destacados</h2>
        <p>{{selectedProgram.Program_name}} ha tenido estupendos logros, más informacion dandlo click abajo</p>
        <button class="btn default">Ver logros</button>
      </div>
      <div class="card">
        <h2>¿Quieres conocer el plan de estudios?</h2>
        <p>{{selectedProgram.Program_name}} es tu mejor opcion<br>Haz click en el siguiente enlace para 
        mas informacion acerca del syllabus del programa</p>
        <button class="btn default"
        @click="location.href='http://www.google.com';">
        Ver Syllabus</button>
      </div>
      <div class="card">
        <h2>Conoce tus futuros docentes</h2>
        <p>Observa el perfil de los docentes inscritos en {{selectedProgram.Program_name}}</p>
        <button class="btn default">Ver Docentes</button>
      </div>
      <div class="card">
        <h2>Modo editor</h2>
        <p>Ingresa un post para esta seccion haciendo click más abajo</p>
          <button class="btn default"
          @click="newPost()">
          Crear Post {{createNewPost}}
        </button>
      </div>
    </div>
  </div>
  <div v-if="seeMorePost==true"/>
    <button class="btn default"
      @click="seeMorePost=false">
      Atras
    </button>
    <div class="card"/>
      <h2>{{selectedPost.Post_title}}</h2>
      <h5>Oct 24, 2018</h5>
      <div class="fakeimg" style="height:150px;">Image</div>
      <p>{{selectedPost.Post_body}}</p>
      <button class="btn info"
        @click="">
        Editar post
      </button>
      <button class="btn warning"
        @click="delPost()">
        Eliminar post
      </button>
    </div>
  </div>
  <div v-else-if="createNewPost==true" style="padding: 16px">
    <h3>Crear nuevo Post</h3>
    <div class="row">
      <button class="btn default"
            @click="createNewPost=false">
              Atras
      </button>
      <button class="btn success"
        @click="sendNewPost()">
        Enviar nuevo post
      </button>
    </div><br>
    <div id="newpost" style="padding:16px">
      <h3>Titulo del Post</h3>
      <input class="full-width" v-model="Post.Post_title"><br>
      <h3>Abstract del Post</h3>
      <textarea class="full-width" v-model="Post.Post_abstract"></textarea><br>
      <h3>Contenido del Post</h3>
      <textarea class="full-width" v-model="Post.Post_body"></textarea><br>
      <h3>Programa del Post</h3>
      <input class="full-width" v-model.number="Post.ID_program" type="number"><br>
      <h3>ID autor</h3>
      <input class="full-width" v-model.number="Post.ID_user" type="number"><br>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
<script>
  //var urlApi='https://api.myjson.com/bins/uow10'
  var urlApi='http://localhost:8080/'
  var programNameSelected = "";
  var app=new Vue({
    el:'#main',
    created: function(){
      axios.defaults.headers.get['Content-Type'] = 'application/json';
      axios.defaults.withCredentials = true;
      axios.defaults.crossDomain = true;
      axios.defaults.headers.post['Content-Type']='application/json';
      this.getMet();
    },
    data:{
      programs:null,
      posts:null,
      selectedProgram:null,
      selectedPost:null,
      someProgramSelected:false,
      createNewPost:false,
      seeMorePost:false,
      Post:{
        ID_post:2,
        Post_title:"Titulo defecto",
        Post_abstract:"Abstract defecto",
        Post_body:"Body defecto",
        ID_user:4,
        ID_program:1
      }
    },
    methods:{
      getMet : function(){
        axios.get(urlApi+'getPrograms').then(response=>(this.programs=response.data));
      },
      getPosts : function(){
        console.log("re-rendered start");
        axios.get(urlApi+'getPosts/'+this.selectedProgram.ID_program).then(response=>(this.posts=response.data));
        this.$nextTick(function () {
          this.show=false;
          this.$nextTick(()=>{
            console.log("re-rendered end");
          });
        });
      },
      updateProgamSelected (selectedItem){
        this.selectedProgram=selectedItem;
        this.someProgramSelected=true;
        this.getPosts();
      },
      sendNewPost(){
        axios({
          method: 'post',
          url: 'http://localhost:8080/newPost',
          withCredentials: true,
          crossdomain: true,
          data: this.Post,
          headers: { 
          "Content-Type": "application/x-www-form-urlencoded"
          }
        });
        this.createNewPost=false;
        this.someProgramSelected=true;
        this.getPosts(); 
      },
      seeMore(selectedItem){
        this.selectedPost=selectedItem;
        this.Post=selectedItem;
        this.seeMorePost=true;
      },
      newPost(){
        this.someProgramSelected=false;
        this.createNewPost=true;
      },
      delPost(){
        this.getMet();
        this.seeMorePost=false;
        this.someProgramSelected=false;
        axios({
          method: 'post',
          url: 'http://localhost:8080/delPost',
          withCredentials: true,
          crossdomain: true,
          data: this.Post,
          headers: { 
          "Content-Type": "application/x-www-form-urlencoded"
          }
        });
        this.getPosts();
        this.someProgramSelected=true;
      }
    }
  });
  var slideIndex = 1;
  showSlides(slideIndex);

  // Next/previous controls
  function plusSlides(n) {
    showSlides(slideIndex += n);
  }

  // Thumbnail image controls
  function currentSlide(n) {
    showSlides(slideIndex = n);
  }

  function showSlides(n) {
    var i;
    var slides = document.getElementsByClassName("mySlides");
    var dots = document.getElementsByClassName("dot");
    if (n > slides.length) {slideIndex = 1} 
    if (n < 1) {slideIndex = slides.length}
    for (i = 0; i < slides.length; i++) {
        slides[i].style.display = "none"; 
    }
    for (i = 0; i < dots.length; i++) {
        dots[i].className = dots[i].className.replace(" active", "");
    }
    slides[slideIndex-1].style.display = "block"; 
    dots[slideIndex-1].className += " active";
  }
</script>

</body>
</html>
